<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>AI KSHETRA Prelims | Event Registration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Futuristic font -->
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">

    {% load static %}
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>

<body>
    <div class="grid-overlay"></div>
    <div class="orb"></div>

    <div class="container">
        <div class="glass-card">
            <div class="badge">
                <div class="badge-dot"></div>
                AI KSHETRA 2025 · PRELIMS
            </div>



            {% if step == 1 %}
            {# ---------------- STEP 1: EVENT + PHONE FORM ---------------- #}
            <div class="title-row">
                <div class="title-main">
                    Choose Your <span>Battlefield</span>
                </div>
                <p class="subtitle">
                    Welcome to the prelims hub of <strong>AI KSHETRA</strong>. Pick your event
                    and enter the <strong>team leader’s phone number</strong> to proceed.
                </p>
            </div>

            <div class="steps">
                STEP 1 · EVENT & PHONE
                <div class="steps-line"></div>
            </div>

            <form id="prelims-form" method="post" action="">
                {% csrf_token %}

                <div class="event-grid" id="event-grid">
                    <!-- Event 1 -->
                    <label class="event-card" data-event-id="event1">
                        <input class="event-radio" type="radio" name="event" value="3" />
                        <div class="event-pill">
                            <div class="event-pill-inner"></div>
                        </div>
                        <div>
                            <div class="event-content-title">Build With AI</div>
                            <div class="event-content-sub">
                                Algorithmic quiz + AI basics. Rapid-fire rounds that test how fast your brain can think
                                in vectors.
                            </div>
                        </div>
                    </label>

                    <!-- Event 2 -->
                    <label class="event-card" data-event-id="event2">
                        <input class="event-radio" type="radio" name="event" value="4" />
                        <div class="event-pill">
                            <div class="event-pill-inner"></div>
                        </div>
                        <div>
                            <div class="event-content-title">CODEWARZ</div>
                            <div class="event-content-sub">
                                ML & computer vision themed prelims. Decode patterns, predict outcomes, and outsmart the
                                system.
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Phone section -->
                <div class="phone-section visible" id="phone-section">
                    <div class="field-label">
                        Team Leader Phone
                        <span>(Given at the time of Registration)</span>
                    </div>
                    <div class="input-wrap">
                        <div class="input-prefix">+91</div>
                        <input type="tel" id="phone" name="phone" class="input" maxlength="10"
                            placeholder="Enter 10-digit mobile number" inputmode="numeric" autocomplete="tel" />
                    </div>
                    <div class="error-text {% if error %}visible{% endif %}" id="error-text">
                        {{ error }}
                    </div>
                </div>

                <div class="bottom-row">
                    <p class="note-text">
                        <strong>Note:</strong> One submission per team. Use the same phone number
                        for all future communication.
                    </p>
                    <button type="submit" class="btn-primary">
                        <span>Proceed to Prelims</span>
                        <span class="icon">⟶</span>
                    </button>
                </div>
            </form>
            {% else %}
            {# ---------------- STEP 2: CONFIRMATION + RULES ---------------- #}
            <div class="title-row">
                <div class="title-main">
                    Confirm Your <span>Squad</span>
                </div>
                <p class="subtitle">
                    We found your registration (temporary dummy validation). Please verify details
                    and read the rules before starting the prelims.
                </p>
            </div>

            <div class="steps">
                STEP 2 · CONFIRM & START
                <div class="steps-line"></div>
            </div>

            <div class="confirm-block">
                <h3>Team Details</h3>
                <p><strong>Team Name:</strong> {{ team.team_name }}</p>
                <p><strong>Event:</strong> {{ team.event_display }}</p>
                <p><strong>Registered Phone:</strong> +91 {{ phone }}</p>

                {% if team.members %}
                <p><strong>Team Members:</strong></p>
                <ul>
                    {% for m in team.members %}
                    <li>{{ m }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="rules-block">
                <h3>Rules & Guidelines</h3>
                <ul class="rules-list">
                    <li>Only the registered team leader should operate the system during prelims.</li>
                    <li>Do not refresh or go back during the quiz once started.</li>
                    <li>Any malpractice or multiple logins may lead to disqualification.</li>
                    <li>Time will start as soon as you enter the prelims environment.</li>
                </ul>
            </div>

            <div class="bottom-row">
                <p class="note-text">
                    By clicking <strong>Start Prelims</strong>, you confirm that the above details are correct and you
                    agree to the rules.
                </p>
                <button class="btn-primary" id="start-prelims-btn">
                    <span>Start Prelims</span>
                    <span class="icon">⟶</span>
                </button>
            </div>
            {% endif %}

            <div class="toast" id="toast">
                <div class="toast-dot"></div>
                <span id="toast-text">Please select an event to continue.</span>
            </div>

            <script>
                (function () {
                    {% if step == 1 %}
                    // STEP 1 JS
                    const eventCards = document.querySelectorAll(".event-card");
                    const phoneInput = document.getElementById("phone");
                    const errorText = document.getElementById("error-text");
                    const form = document.getElementById("prelims-form");
                    const toast = document.getElementById("toast");
                    const toastText = document.getElementById("toast-text");

                    let selectedEvent = null;

                    function showToast(message) {
                        toastText.textContent = message;
                        toast.classList.add("visible");
                        setTimeout(() => {
                            toast.classList.remove("visible");
                        }, 2500);
                    }

                    function validatePhone(phone) {
                        const digitsOnly = phone.replace(/\D/g, "");
                        return digitsOnly.length === 10 && /^([6-9]\d{9})$/.test(digitsOnly);
                    }

                    eventCards.forEach(card => {
                        card.addEventListener("click", () => {
                            eventCards.forEach(c => c.classList.remove("selected"));
                            card.classList.add("selected");

                            const radio = card.querySelector(".event-radio");
                            radio.checked = true;
                            selectedEvent = radio.value;
                        });
                    });

                    phoneInput.addEventListener("input", () => {
                        phoneInput.value = phoneInput.value.replace(/\D/g, "").slice(0, 10);
                        errorText.classList.remove("visible");
                    });

                    form.addEventListener("submit", (e) => {
                        const phone = phoneInput.value.trim();
                        const anySelected = Array.from(document.querySelectorAll(".event-radio"))
                            .some(r => r.checked);

                        if (!anySelected) {
                            e.preventDefault();
                            showToast("Please select an event to continue.");
                            return;
                        }

                        if (!validatePhone(phone)) {
                            e.preventDefault();
                            errorText.textContent = "Enter a valid 10-digit Indian mobile number starting with 6-9.";
                            errorText.classList.add("visible");
                            phoneInput.focus();
                            return;
                        }
                        // Normal POST to Django view
                    });
                    {% else %}
                    // STEP 2 JS
                    const startBtn = document.getElementById("start-prelims-btn");
                    if (startBtn) {
                        startBtn.addEventListener("click", () => {
                            // TODO: change URL to your actual quiz route
                            // Example: /quiz/1/?phone=...
                            const phone = "{{ phone }}";
                            const eventCode = "{{ event_code }}";  // "3" or "2" – also quiz id
                            const params = new URLSearchParams({ phone: phone, event: eventCode });

                            // use selected event as quiz id
                            window.location.href = "/quiz/" + encodeURIComponent(eventCode) + "/?" + params.toString();

                        });
                    }
                    {% endif %}
                })();
            </script>

</body>

</html>